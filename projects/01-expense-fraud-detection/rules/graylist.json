{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Graylist Rules",
  "description": "MCC codes and patterns requiring deeper review",
  "version": "1.0.0",
  "effective_from": "2025-01-01",
  "effective_until": null,

  "graylist_mccs": [
    {
      "code": "7273",
      "category": "Dating/Escort Services",
      "description": "Dating and escort services",
      "risk_score": 35,
      "review_required": true,
      "justification_required": true,
      "reason": "유흥성 지출 의심",
      "required_evidence": [
        "업무 관련성 설명",
        "참석자 명단",
        "회의록 또는 계약서",
        "영수증"
      ]
    },
    {
      "code": "5813",
      "category": "Drinking Places (Alcoholic Beverages)",
      "description": "Bars, taverns, nightclubs, cocktail lounges",
      "risk_score": 25,
      "review_required": true,
      "justification_required": true,
      "reason": "접대비 또는 개인 유흥 의심",
      "required_evidence": [
        "거래처 정보",
        "참석자 명단 (내부 + 외부)",
        "영수증"
      ],
      "auto_approve_conditions": [
        {
          "condition": "AMOUNT_BELOW_THRESHOLD",
          "threshold": 50000,
          "currency": "KRW",
          "description": "5만원 이하 소액은 자동 승인"
        },
        {
          "condition": "LINKED_TO_APPROVED_EVENT",
          "description": "사전 승인된 접대 일정과 연결된 경우"
        }
      ]
    },
    {
      "code": "5921",
      "category": "Package Stores - Beer, Wine, and Liquor",
      "description": "Liquor stores",
      "risk_score": 20,
      "review_required": true,
      "justification_required": true,
      "reason": "주류 구매 (접대비 또는 개인 소비)",
      "required_evidence": [
        "사용 목적 (회사 행사, 거래처 선물 등)",
        "영수증"
      ]
    },
    {
      "code": "5735",
      "category": "Record Stores",
      "description": "Music, video, games - entertainment",
      "risk_score": 15,
      "review_required": true,
      "justification_required": false,
      "reason": "엔터테인먼트 구매 (업무 관련성 확인 필요)",
      "required_evidence": [
        "업무 관련성 설명"
      ]
    },
    {
      "code": "5999",
      "category": "Miscellaneous Specialty Retail",
      "description": "Various specialty items",
      "risk_score": 10,
      "review_required": false,
      "justification_required": false,
      "reason": "기타 소매 (고액인 경우만 검토)",
      "required_evidence": [],
      "trigger_conditions": [
        {
          "field": "amount",
          "operator": ">=",
          "value": 500000,
          "currency": "KRW"
        }
      ]
    }
  ],

  "graylist_patterns": [
    {
      "pattern_id": "LATE_NIGHT",
      "description": "심야 시간대 거래 (22:00 ~ 06:00)",
      "conditions": [
        {
          "field": "transaction_hour",
          "operator": "NOT_BETWEEN",
          "value": [6, 22]
        }
      ],
      "risk_score_modifier": 20,
      "review_required": true,
      "auto_exclude_conditions": [
        {
          "condition": "FREQUENT_TRAVELER",
          "description": "빈번 출장자는 시차 고려하여 면제"
        },
        {
          "condition": "LINKED_TO_BUSINESS_TRIP",
          "description": "출장 일정과 연결된 경우 면제"
        }
      ]
    },
    {
      "pattern_id": "WEEKEND_HOLIDAY",
      "description": "주말/공휴일 거래",
      "conditions": [
        {
          "field": "transaction_day",
          "operator": "IN",
          "value": ["SATURDAY", "SUNDAY"]
        }
      ],
      "risk_score_modifier": 15,
      "review_required": false,
      "notes": "업무 특성상 주말 근무가 흔한 부서는 면제"
    },
    {
      "pattern_id": "LOCATION_MISMATCH",
      "description": "근무지와 50km 이상 거리, 출장 기록 없음",
      "conditions": [
        {
          "field": "distance_from_office",
          "operator": ">",
          "value": 50,
          "unit": "km"
        },
        {
          "field": "linked_trip",
          "operator": "IS_NULL"
        }
      ],
      "risk_score_modifier": 25,
      "review_required": true,
      "required_evidence": [
        "위치 설명 (출장, 재택근무 등)",
        "영수증"
      ]
    },
    {
      "pattern_id": "SPLIT_PAYMENT",
      "description": "30분 내 동일 가맹점 3건 이상 (한도 회피 의심)",
      "conditions": [
        {
          "field": "same_merchant_count",
          "operator": ">=",
          "value": 3,
          "timeframe": "30 minutes"
        }
      ],
      "risk_score_modifier": 35,
      "review_required": true,
      "severity": "HIGH",
      "required_evidence": [
        "분할 결제 사유",
        "모든 거래의 영수증",
        "상사 승인"
      ]
    },
    {
      "pattern_id": "RECEIPT_MISSING",
      "description": "10만원 이상 거래, 영수증 미제출 (72시간 경과)",
      "conditions": [
        {
          "field": "amount",
          "operator": ">=",
          "value": 100000,
          "currency": "KRW"
        },
        {
          "field": "receipt_submitted",
          "operator": "=",
          "value": false
        },
        {
          "field": "hours_since_transaction",
          "operator": ">",
          "value": 72
        }
      ],
      "risk_score_modifier": 40,
      "review_required": true,
      "severity": "HIGH",
      "action": "HOLD_REIMBURSEMENT"
    },
    {
      "pattern_id": "RECEIPT_MISMATCH",
      "description": "영수증 금액/가맹점이 거래 내역과 불일치",
      "conditions": [
        {
          "field": "receipt_amount_diff_pct",
          "operator": ">",
          "value": 5
        }
      ],
      "risk_score_modifier": 30,
      "review_required": true,
      "severity": "MEDIUM",
      "required_evidence": [
        "불일치 사유 설명",
        "추가 증빙"
      ]
    },
    {
      "pattern_id": "RAPID_SPENDING",
      "description": "1일 지출이 평소의 3배 이상",
      "conditions": [
        {
          "field": "daily_spending",
          "operator": ">",
          "value": "3x_avg_30days"
        }
      ],
      "risk_score_modifier": 20,
      "review_required": false,
      "notes": "출장 중인 경우 자동 면제"
    }
  ],

  "review_workflow": {
    "threshold": {
      "auto_case_creation": 50,
      "urgent_review": 70
    },
    "assignment": {
      "default_reviewer": "MANAGER",
      "high_severity_reviewer": "FINANCE_TEAM",
      "escalation_threshold": 85,
      "escalation_target": "CFO"
    },
    "sla": {
      "response_time_hours": 24,
      "resolution_time_hours": 72,
      "overdue_escalation": true
    }
  },

  "whitelist_overrides": {
    "whitelisted_merchants": {
      "description": "회사 지정 호텔/출장 대행사는 모든 패턴에서 면제",
      "applies_to_patterns": ["LATE_NIGHT", "WEEKEND_HOLIDAY", "RAPID_SPENDING"]
    },
    "frequent_travelers": {
      "description": "빈번 출장자는 위치/시간대 패턴 가중치 50% 감소",
      "applies_to_patterns": ["LATE_NIGHT", "LOCATION_MISMATCH"],
      "score_modifier": -0.5
    },
    "executive_tier": {
      "description": "임원은 일부 패턴 면제 (단, 감사 로그 필수)",
      "applies_to_patterns": ["WEEKEND_HOLIDAY"],
      "require_audit_log": true
    }
  }
}
